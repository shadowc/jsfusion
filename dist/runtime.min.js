(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Component:()=>T,Runtime:()=>I});var n,o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},a=function(){function t(){this.attributes={}}return t.prototype.registerAttributeHandler=function(t,e){if(this.attributes[t])throw r("Initialization Error: Callback for attribute ".concat(t," already registered. You can only register one callback per attribute type. Try registering another attribute!")),"Attribute callback initialization error.";this.attributes[t]=e},t}(),i=function(){function t(t){this.parent=t}return t.prototype.handleAttribute=function(t,e){},t}(),p=function(t,e,n){void 0===n&&(n=!1);var r=t.getAttribute(e),a=r?r.trim():"";o("Parsing attribute ".concat(e,' for value "').concat(a,'"'));try{return JSON.parse(a)}catch(t){return n?a.split(","):a.split(" ")}},c=function(t){if(!Array.isArray(t))throw r("Invalid data when trying to parse data-component attribute",t),"Syntax error data-component.";return t.forEach((function(e){if("string"!=typeof e)throw r("Invalid data when trying to parse data-component attribute",t),"Syntax error data-component."})),t},s=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.handleAttribute=function(t,e){var n=this;c(p(e,t)).forEach((function(t){n.parent.registerComponentElement(t,e)}))},e}(i),f=function(t,e){var n=[];return e.forEach((function(e){e.node===t&&n.push({name:e.name,component:e.component,node:t})})),n},l=function(t){return null!==t&&"object"==typeof t&&"string"==typeof t["#parentProp"]},d=function(t,e){return t.type===String&&"string"==typeof e||t.type===Boolean&&"boolean"==typeof e||t.type===Number&&"number"==typeof e||t.type===Array&&Array.isArray(e)||t.type===Object&&e instanceof Object&&!Array.isArray(e)||l(e)},h=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.handleAttribute=function(t,e){if(!e.hasAttribute("data-component"))throw r("Error: Prop attributes must be declared in the same element that defines the component."),"data-props attribute doesn't belong to a component element";var n=c(p(e,"data-component")),o=function(t,e){var n;if("object"==typeof t&&!Array.isArray(t))return 1===e.length&&(-1===Object.keys(t).indexOf(e[0])||"object"!=typeof t[e[0]]||Array.isArray(t[e[0]])||l(t[e[0]]))?((n={})[e[0]]=t,n):(e.length>1&&Object.keys(t).forEach((function(t){if(-1===e.indexOf(t))throw r("Error: Prop attributes must be declared in the same element that defines the component. Elements with multiple components must have props defined for each of its components."),"data-props attribute doesn't belong to a component element."})),t);if(!Array.isArray(t))throw r("Invalid data when trying to parse data-props attribute",t),"Syntax error data-props.";var o={};return t.forEach((function(n){if("string"!=typeof n)throw r("Invalid data when trying to parse data-prop attribute",t),"Syntax error data-prop.";var a=n.trim().match(/^((.+)\.)?(.+):\s*(#parentProp\.)?(.+),?$/);if(null===a)throw r("Invalid syntax when trying to parse a data-prop strategy",n),"Syntax error data-prop.";var i=null;if(void 0===a[2]){if(e.length>1)throw r("Error: Elements with multiple components must have props defined for each of its components."),"data-props attribute doesn't belong to a component element.";i=e[0]}else{if(-1===e.indexOf(a[2]))throw r("Error: Elements with multiple components must have props defined for each of its components."),"data-props attribute doesn't belong to a component element.";i=a[2]}var p=a[3],c=void 0!==a[4],s=a[5];o[i]||(o[i]={}),o[i][p]=function(t,e){if(e)return{"#parentProp":t};var n;try{n=JSON.parse(t)}catch(e){n=String(t)}return n}(s,c)})),o}(p(e,t,!0),n);f(e,this.parent.componentRegistry).forEach((function(t){var e=o[t.name];Object.keys(e).forEach((function(n){var o=t.component.propTypes[n];if(void 0!==o){if(!d(o,e[n]))throw r("Invalid prop type for ".concat(n,"."),o,e[n]),"Invalid prop-type.";t.component.createProp(n,e[n])}})),Object.keys(t.component.propTypes).forEach((function(e){if(t.component.propTypes[e].required&&void 0===t.component.props[e])throw r("The prop ".concat(e," is required but hasn't been defined! Consider adding a default value.")),"Required prop not defined."}))}))},e}(i),m=function(t,e,n){for(var o,r=t;r&&"html"!==r.nodeName.toLowerCase();){o=f(r,n.componentRegistry);for(var a=0;a<o.length;a++)if(o[a].name===e)return o[a].component;r=r.parentElement}return null},b=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return b(e,t),e.prototype.handleAttribute=function(t,e){var n=this;(function(t){if(!Array.isArray(t))throw r("Invalid data when trying to parse data-bind attribute",t),"Syntax error data-bind.";var e=[];return t.forEach((function(n){if("string"!=typeof n)throw r("Invalid data when trying to parse data-bind attribute",t),"Syntax error data-bind.";var o=n.match(/^(.+):(.+)\.(.+)$/);if(null===o)throw r("Invalid syntax when trying to parse a data-bind strategy",n),"Syntax error data-bind.";e.push({strategyName:o[1],componentName:o[2],propName:o[3]})})),e})(p(e,t)).forEach((function(t){if(o("Attempting to bind for ".concat(t.strategyName,' on "').concat(t.componentName,".").concat(t.propName,'".')),void 0===n.parent.dataBindHandlers.handlers[t.strategyName])throw o('Error trying to bind for strategy "'.concat(t.strategyName,'". No such strategy exists!')),"Invalid data-bind strategy.";var r=n.parent.dataBindHandlers.handlers[t.strategyName],a=m(e,t.componentName,n.parent);if(null===a)throw o('Error trying to find component "'.concat(t.componentName,'" for data binding. Have you misspelled the component name?')),"Invalid component in data-bind. Component not found.";var i=a.props[t.propName];if(void 0===i)throw o('Error trying to bind "'.concat(t.strategyName,'" to "').concat(t.componentName,".").concat(t.propName,"\". The prop doesn't exist.")),"Invalid prop name in data-bind. Found component but no prop found.";a.addPropSideEffect(t.propName,(function(t){r.updateBinding(e,t)})),r.updateBinding(e,i)}))},e}(i),g=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return g(e,t),e.prototype.handleAttribute=function(t,e){var n=this;(function(t){if(!Array.isArray(t))throw r("Invalid data when trying to parse data-on attribute",t),"Syntax error data-on.";var e=[];return t.forEach((function(n){if("string"!=typeof n)throw r("Invalid data when trying to parse data-on attribute",t),"Syntax error data-on.";var o=n.match(/^(.+):(.+)\.(.+)$/);if(null===o)throw r("Invalid syntax when trying to parse a data-on strategy",n),"Syntax error data-on.";e.push({eventName:o[1],componentName:o[2],callbackName:o[3]})})),e})(p(e,t)).forEach((function(t){o("Attempting to bind event ".concat(t.eventName,' on "').concat(t.componentName,".").concat(t.callbackName,'".'));var r=m(e,t.componentName,n.parent);if(null===r)throw o('Error trying to find component "'.concat(t.componentName,'" for event handler binding. Have you misspelled the component name?')),"Invalid component in data-on. Component not found.";if("function"!=typeof r[t.callbackName])throw o('Error trying to bind "'.concat(t.eventName,'" to "').concat(t.componentName,".").concat(t.callbackName,"\". The callback function doesn't exist or it's not a function.")),"Invalid callback in data-on. Found component but no proper callback found.";r.addEventHandler(t.eventName,r[t.callbackName],e)}))},e}(i),w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return w(e,t),e.prototype.handleAttribute=function(t,e){var n=this;(function(t){if(!Array.isArray(t))throw r("Invalid data when trying to parse data-ref attribute",t),"Syntax error data-ref.";var e=[];return t.forEach((function(n){if("string"!=typeof n)throw r("Invalid data when trying to parse data-ref attribute",t),"Syntax error data-ref.";var o=n.match(/^(.+)\.(.+)$/);if(null===o)throw r("Invalid syntax when trying to parse a data-ref strategy",n),"Syntax error data-ref.";e.push({componentName:o[1],refName:o[2]})})),e})(p(e,t)).forEach((function(t){o('Attempting to bind a ref on "'.concat(t.componentName,".").concat(t.refName,'".'));var r=m(e,t.componentName,n.parent);if(null===r)throw o('Error trying to find component "'.concat(t.componentName,'" for data ref. Have you misspelled the component name?')),"Invalid component in data-ref. Component not found.";r.addRef(t.refName,e)}))},e}(i),O=function(){function t(){this.handlers={}}return t.prototype.registerDataBindStrategy=function(t,e){if(this.handlers[t])throw r("Initialization Error: Handler for data bind strategy ".concat(t," already registered. You can only register one callback per bind strategy.")),"Data bind strategy initialization error.";this.handlers[t]=e},t}(),A=function(){function t(){}return t.prototype.updateBinding=function(t,e){},t}(),P=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return P(e,t),e.prototype.updateBinding=function(t,e){t.innerText=null===e?"":e},e}(A),S=function(t,e){var n=[];return t.forEach((function(t){if(t instanceof Element){var o=f(t,e);o.length>0?o.forEach((function(t){n.push(t.component)})):t.childNodes.length&&S(t.childNodes,e).forEach((function(t){n.push(t)}))}})),n},j=function(t,e){if(!l(e))return null;var n=e["#parentProp"].split(".");return n.length>2||null===t.parent?null:2===n.length?null===t.parents||void 0===t.parents[n[0]]?null:t.parents[n[0]]:null!==t.parents&&Object.keys(t.parents).length>1?null:t.parent},C=function(t){if(!l(t))return null;var e=t["#parentProp"].split(".");return e.length>2?null:e[e.length-1]},x=function(){function t(t){this._valueMap={},this._component=t}return t.prototype.addProp=function(t,e){var n=this;if(l(e)&&null===j(this._component,e))throw r("Invalid prop definition: Cannot find the right component to get value from (".concat(e["#parentProp"],").")),"Invalid prop value for deferred prop.";Object.defineProperty(this,t,{get:function(){var o=n._valueMap[t];if(l(o)){var a=j(n._component,o);if(null===a)throw r('Attempting to get value for deferred prop "'.concat(e["#parentProp"],'" but no such parent exists.')),"Invalid prop value for deferred prop.";return a.props[C(o)]}return n._valueMap[t]},set:function(e){var o=n.getPropValues();if(null===n._component.propTypes[t])throw r("Attempting to assign property ".concat(t," but it wasn't defined in propTypes. Did you forget to redefine setPropTypes() in your controller and make it return an object?")),"Attempting to set a non defined prop";if(!d(n._component.propTypes[t],e))throw r("Invalid prop type for ".concat(t,"."),n._component.propTypes[t],e),"Invalid prop-type.";if(l(e)){if(null===(a=j(n._component,e)))throw r('Attempting to set a prop to a deferred prop "'.concat(e["#parentProp"],'" but no such parent exists.')),"Invalid prop value for deferred prop.";n._valueMap[t]=e,n.handleSideEffects(t,o),n.updatePropsAttribute(t)}else if(l(n._valueMap[t])){var a;if(null===(a=j(n._component,n._valueMap[t])))throw r('Attempting to assign a value for deferred prop "'.concat(n._valueMap[t]["#parentProp"],'" but no such parent exists.')),"Invalid prop value for deferred prop.";a.props[C(n._valueMap[t])]=e,n.handleSideEffects(t,o)}else n._valueMap[t]=e,n.handleSideEffects(t,o),n.updatePropsAttribute(t)}}),this._valueMap[t]=e,this.handleSideEffects(t,null)},t.prototype.handleSideEffects=function(t,e){var n=this,o=this.getPropValues();this._component.onPropChanged(e,o,t),void 0!==this._component.propSideEffects[t]&&this._component.propSideEffects[t].forEach((function(e){e(n[t])})),this._component.children.forEach((function(n){void 0!==n.props[t]&&n.props.handleSideEffects(t,e)}))},t.prototype.getPropValues=function(){var t=this,e={};return Object.keys(this._component.propTypes).forEach((function(n){e[n]=t[n]})),e},t.prototype.updatePropsAttribute=function(t){var e=this._component.element.getAttribute("data-props");if(e){var n=this._component.componentName;try{var o=JSON.parse(e);if(void 0!==o[n]&&void 0!==o[n][t]){if(l(o[n][t]))return;return o[n][t]=this._valueMap[t],void this._component.element.setAttribute("data-props",JSON.stringify(o))}if(void 0!==o[t]){if(l(o[t]))return;return o[t]=this._valueMap[t],void this._component.element.setAttribute("data-props",JSON.stringify(o))}}catch(o){for(var r=e.split(","),a=0;a<r.length;a++){r[a]=r[a].trim();var i=r[a].match(/^((.+)\.)?(.+):\s*(#parentProp\.)?(.+),?$/);if(null!==i&&(void 0!==i[2]&&n===i[2]||void 0===i[2])&&i[3]===t&&void 0===i[4]){r[a]=void 0!==i[2]?"".concat(i[2],".").concat(i[3],": ").concat(JSON.stringify(this._valueMap[t]).trim()):"".concat(i[3],": ").concat(JSON.stringify(this._valueMap[t]).trim());break}}var p=r[0].trim();for(a=1;a<r.length;a++)p+=", "+r[a].trim();return void this._component.element.setAttribute("data-props",p)}}},t}(),T=function(){function t(t,e,n){this.componentRegistry=e,this._element=t,this.props=new x(this),this.propSideEffects={},this._refs={},this._eventHandlers=[],this._propTypes=this.setPropTypes(),this._componentName=n,this.initializePropTypes()}return Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"propTypes",{get:function(){return this._propTypes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refs",{get:function(){return this._refs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"eventHandlers",{get:function(){return this._eventHandlers},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"componentName",{get:function(){return this._componentName},enumerable:!1,configurable:!0}),t.prototype.setPropTypes=function(){return{}},t.prototype.onCreated=function(){},t.prototype.onPropChanged=function(t,e,n){},t.prototype.onDestroyed=function(){},t.prototype.initializePropTypes=function(){var t=this,e=!1;if(Object.keys(this.propTypes).forEach((function(n){t.propTypes[n].required&&void 0===t.propTypes[n].defaultValue&&(e=!0),void 0!==t.propTypes[n].defaultValue&&t.createProp(n,t.propTypes[n].defaultValue)})),e&&!this.element.hasAttribute("data-props"))throw r("Failed to initialize component. The component has required props but no data-props attribute found."),"Failed to initialize component. The component has required props but no data-props attribute found."},Object.defineProperty(t.prototype,"children",{get:function(){var t=this.element.childNodes;return S(t,this.componentRegistry)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parents",{get:function(){for(var t,e=this.element.parentElement,n=function(){if((t=f(e,o.componentRegistry)).length>0){var n={};return t.forEach((function(t){n[t.name]=t.component})),{value:n}}e=e.parentElement},o=this;e&&"html"!==e.nodeName.toLowerCase();){var r=n();if("object"==typeof r)return r.value}return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){for(var t,e=this.element.parentElement;e&&"html"!==e.nodeName.toLowerCase();){if((t=f(e,this.componentRegistry)).length>0)return t[0].component;e=e.parentElement}return null},enumerable:!1,configurable:!0}),t.prototype.createProp=function(t,e){void 0===this.props[t]?(o("Creating prop ".concat(t),e),this.props.addProp(t,e)):this.props[t]=e},t.prototype.addPropSideEffect=function(t,e){void 0===this.propSideEffects[t]&&(this.propSideEffects[t]=[]),this.propSideEffects[t].push(e)},t.prototype.addRef=function(t,e){void 0!==this._refs[t]?(Array.isArray(this._refs[t])||(this._refs[t]=[this._refs[t]]),this._refs[t].push(e)):this._refs[t]=e},t.prototype.addEventHandler=function(t,e,n){var o={eventName:t,callback:e,boundCallback:e.bind(this),target:n};this._eventHandlers.push(o),n.addEventListener(t,o.boundCallback)},t.prototype.emit=function(t,e,n){(void 0!==n?n:this.element).dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:e}))},t}(),I=function(){function t(){this.version="1.0.0-alpha.2",this.componentRegistry=[],this.components={},this.mutationObserver=new MutationObserver(this.mutationObserverHandler.bind(this)),this.observableAttributes=new a,this.dataBindHandlers=new O,this.createdComponentsQueue=[],this.observableAttributes.registerAttributeHandler("data-component",new u(this)),this.observableAttributes.registerAttributeHandler("data-props",new y(this)),this.observableAttributes.registerAttributeHandler("data-bind",new v(this)),this.observableAttributes.registerAttributeHandler("data-on",new _(this)),this.observableAttributes.registerAttributeHandler("data-ref",new E(this)),this.dataBindHandlers.registerDataBindStrategy("text",new N)}return t.prototype.mutationObserverHandler=function(t){t.forEach((function(t){o(t)}))},t.prototype.start=function(){var t=this,e=Object.keys(this.observableAttributes.attributes);e.forEach((function(e){document.body.querySelectorAll("*["+e+"]").forEach((function(n){t.observableAttributes.attributes[e].handleAttribute(e,n)}))})),this.mutationObserver.observe(document.body,{attributes:!0,attributeFilter:e,attributeOldValue:!0,childList:!0,subtree:!0}),this.flushCreatedComponentQueue()},t.prototype.registerComponent=function(t,e){o('Registering component "'.concat(t,'" for general use.')),void 0===this.components[t]&&(this.components[t]=e)},t.prototype.registerComponentElement=function(t,e){if(o('Registering component "'.concat(t,'" on'),e),void 0===this.components[t])throw r('The component "'.concat(t,"\" is not registered in JsFusion. Did you forget to run Runtime.registerComponent('").concat(t,"', MyComponentClass)?")),"Error while instantiating component";var n=this.components[t];this.componentRegistry.forEach((function(n){if(n.node===e&&n.name===t)throw r('The component "'.concat(t,'" has been already instantiated for ').concat(e,"!")),"Error while instantiating component"})),this.componentRegistry.push({name:t,component:new n(e,this.componentRegistry,t),node:e}),this.createdComponentsQueue.push(this.componentRegistry[this.componentRegistry.length-1].component)},t.prototype.flushCreatedComponentQueue=function(){for(;this.createdComponentsQueue.length;)this.createdComponentsQueue.pop().onCreated()},t.prototype.destroyComponentRegistry=function(t){t>=0&&t<this.componentRegistry.length&&(this.componentRegistry[t].component.onDestroyed(),this.componentRegistry[t].component.eventHandlers.forEach((function(t){t.target.removeEventListener(t.eventName,t.boundCallback)})),this.componentRegistry.splice(t,1))},t}();exports.Component=e.Component,exports.Runtime=e.Runtime,Object.defineProperty(exports,"__esModule",{value:!0})})();